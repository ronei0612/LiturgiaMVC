@model LinksModel

@{
    ViewData["Title"] = "Youtube";
}

<body>
	<br />

	<form onsubmit="event.preventDefault(); criarUrl();">
		<div class="input-group">
			<input type="text" class="form-control" placeholder="Pesquisar" aria-label="Pesquisar" aria-describedby="basic-addon1" name="texto" id="texto">
			<button class="input-group-text" id="basic-addon1" onclick="criarUrl()">
				<svg width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
					<path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"></path>
				</svg>
			</button>
		</div>
	</form>

	<br />

	@if (Model.YoutubeImageLinks != null) {

		if (Model.YoutubeImageLinks.Count == 1)
		{
			<iframe id="youtubeFrame" src="@Model.YoutubeImageLinks.ElementAt(0).Value" allowfullscreen allow="autoplay" style="width:100%"></iframe>
		}

		else
		{
			foreach (var linkYoutube in Model.YoutubeImageLinks)
			{
				string linkid = linkYoutube.Value.Replace("https://www.youtube.com/embed/", "");
				string playlistid = linkYoutube.Value.Replace("https://www.youtube.com/embed/videoseries?list=", "");

				if (linkYoutube.Value.Contains("playlist"))
				{
					<a href="#" id="@playlistid" onclick="AbrirVideo('playlist' + '@playlistid')">
						<img class="rounded border-1" src="@linkYoutube.Key" />
					</a>
				}

				else
				{
					<a href="#" id="@linkid" onclick="AbrirVideo('@linkid')">
						<img class="rounded" src="@linkYoutube.Key" />
					</a>
				}
				
			}

			<div id="video"></div>
		}
	}

	else
	{
		<div id="video"></div>
	}

	<br />

	<div id="botoes">

		<button type="button" class="btn btn-secondary" id="lupa" onclick="Pesquisar()">
			<svg width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
				<path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"></path>
			</svg>
		</button>
	</div>

	<script>
		//} VER ESSA DOCUMENTAÇÃO
		//https://developers.google.com/youtube/iframe_api_reference?hl=pt-br

		var inputPesquisa = document.getElementById('inputPesquisa');
		
		if (document.getElementById('video'))
			inputPesquisa.style.display = 'block';

		function Pesquisar(){
			if (inputPesquisa.style.display === 'block')
				inputPesquisa.style.display = 'none';
			else
				inputPesquisa.style.display = 'block';
		}

		function AbrirVideo(linkid) {
			var linkElement = document.getElementById(linkid.replace('playlist', ''));
			var frame = document.createElement("iframe");

			if (linkid.includes('playlist'))
				frame.setAttribute('src', "https://www.youtube.com/embed/videoseries?list==" + linkid.replace('playlist', ''));
			else
				frame.setAttribute('src', "https://www.youtube.com/embed/" + linkid);
			frame.style.position = "relative";
			frame.style.height = "250px";

			if ($(window).width() <= 699)
				frame.style.width = "100%";
			else
				frame.style.width = "33%";
			linkElement.parentNode.replaceChild(frame, linkElement);
		}

		function criarUrl() {
			var texto = document.getElementById('texto').value;
			var url = new URL(texto);
			var host = url.host;
			var searchParams = new URLSearchParams(url.search);
			var id;
			
			if (host.includes('youtube.com')) {
				if (searchParams.has('v'))
					id = 'v=' + searchParams.get('v');
				else if (searchParams.has('list'))
					id = 'list=' + searchParams.get('list');
				else if (url.pathname.startsWith('/shorts/'))
					id = 'v=' + url.pathname.split('/')[2];
			} else if (host.includes('youtu.be')) {
				id = url.pathname.slice(1);
				if (searchParams.has('si'))
					id += '?si=' + searchParams.get('si');
				id = 'v=' + id;
			}

			if (id)
				window.location.href = window.location.origin + '/youtube?' + id;
		}
	</script>
</body>