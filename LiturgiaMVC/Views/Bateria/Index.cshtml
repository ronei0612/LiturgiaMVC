@model LinksModel

@{
	ViewData["Title"] = "Bateria";
	Layout = "~/Views/Bateria/_Layout.cshtml";
}

<div class="centralizado-no-container pure-form">
	<div id="bateriaBotoes" style="display:none">
		<table style="margin-left:-12px">
			<tr>
				<td style="position: relative">
					<div class="light" id="lightCompasso"></div>
				</td>
				<td>
					<button id="play-pause_bateria" data-playing="false" class="botao parar" onclick="playBotaoBateria(this, false)">
						<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 200.000000 200.000000" preserveAspectRatio="xMidYMid meet" id="prepararBateriaBotao">
							<g transform="translate(0.000000,200.000000) scale(0.100000,-0.100000)" fill="#fff" stroke="none">
								<path d="M436 1631 c-16 -11 -38 -34 -50 -53 -21 -32 -21 -41 -21 -578 0 -606 -3 -582 67 -632 30 -21 44 -23 145 -23 121 0 142 7 187 69 21 27 21 40 24 574 3 611 5 592 -67 639 -30 21 -46 23 -145 23 -92 0 -116 -3 -140 -19z m232 -625 c1 -375 -1 -523 -9 -532 -15 -18 -150 -19 -167 -2 -9 9 -12 140 -12 528 0 284 3 520 7 524 4 4 46 5 93 4 l85 -3 3 -519z" />
								<path d="M919 1627 c-71 -47 -69 -30 -69 -630 0 -594 -1 -584 62 -629 35 -24 102 -34 140 -19 14 5 175 133 356 284 342 285 352 296 352 370 0 60 -38 99 -355 361 -173 143 -324 265 -337 272 -38 22 -110 17 -149 -9z m406 -353 c171 -141 311 -264 313 -273 2 -12 -92 -96 -314 -281 -255 -211 -320 -261 -333 -253 -14 9 -16 67 -19 524 -1 283 0 520 3 527 2 6 13 12 22 12 10 0 158 -115 328 -256z" />
							</g>
						</svg>

						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-stop-fill" viewBox="0 0 16 16" style="display:none" id="pararBateriaBotao">
							<path d="M5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5A1.5 1.5 0 0 1 5 3.5z" />
						</svg>
					</button>
				</td>
				<td>
					<select class="form-control" onchange="selecionarInstrumento(true)" id="selectRitmo" style="height:45px;font-size:18px">
						@*<option selected value=""></option>*@
					</select>
				</td>
			</tr>
			<tr>
				<td>
					<button id="brush" class="botao dedo" onclick="playBotaoBateria(this)">
						<svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" viewBox="0 0 32 32">
							<g>
								<path d="M13.9,6.7C13,3.5,10.1,1.4,7.2,2C4.3,2.5,2.4,5.5,2.7,8.9C6.6,9.4,10.5,8.6,13.9,6.7z" />
								<path d="M11.8,14.3c1.6-1.2,2.5-3.2,2.5-5.4c-2.8,1.5-6,2.2-9.1,2.2c-0.6,0-1.3,0-1.9-0.1c0.8,2,2.4,3.6,4.2,4.1l1.7,11.7 c0.1,0.8,0.5,1.5,1.1,1.9c0.5,0.4,1.1,0.5,1.6,0.5c0.2,0,0.3,0,0.5,0c0.8-0.1,1.4-0.6,1.8-1.2c0.4-0.6,0.5-1.4,0.3-2.2L11.8,14.3z" />
							</g>
							<g>
								<path d="M29,10.6c0.3-3.2-1.5-6.1-4.3-6.6c0,0,0,0,0,0c-2.8-0.5-5.6,1.5-6.5,4.6C21.5,10.3,25.3,11.1,29,10.6z" />
								<path d="M26.8,12.7c-3.1,0-6.1-0.7-8.9-2.1c0,2.1,0.9,4,2.4,5.1l-2.7,10.9c-0.2,0.7-0.1,1.5,0.3,2.1c0.4,0.6,1,1.1,1.8,1.2 c0.2,0,0.3,0,0.5,0c0.6,0,1.1-0.2,1.6-0.5c0.6-0.4,1-1.1,1.1-1.8l1.6-11.2c1.8-0.5,3.2-2,4-3.9C28,12.7,27.4,12.7,26.8,12.7z" />
							</g>
						</svg>
					</button>
				</td>
				<td>
					<button id="aro" class="botao dedo" onclick="playBotaoBateria(this)">
						<svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" viewBox="0 0 32 32">
							<g>
								<path d="M3,20.8V25c0,3.3,6.5,5,13,5s13-1.7,13-5v-4.2c-2.8,2.3-8.2,3.2-13,3.2S5.8,23.1,3,20.8z" />
								<path d="M29.8,2.3c-0.4-0.4-1-0.5-1.4-0.1l-16,14c-0.4,0.4-0.5,1-0.1,1.4c0.2,0.2,0.5,0.3,0.8,0.3c0.2,0,0.5-0.1,0.7-0.2l16-14 C30.1,3.4,30.1,2.8,29.8,2.3z" />
								<path d="M22.5,12.6L15,19.3c-0.5,0.5-1.2,0.7-2,0.7c-0.9,0-1.7-0.4-2.3-1c-1.1-1.3-1-3.1,0.3-4.2l3.1-2.7C8.3,12.4,3,14,3,17 c0,3.3,6.5,5,13,5s13-1.7,13-5C29,14.9,26.2,13.4,22.5,12.6z" />
							</g>
						</svg>
					</button>
				</td>
				<td>
					<button id="caixa" class="botao dedo" onclick="playBotaoBateria(this)">
						<svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" viewBox="0 0 512 512"> <path d="M431.34 122.05l73.53-47.42a16 16 0 0 0 4.44-22.19l-8.87-13.31a16 16 0 0 0-22.19-4.44l-110.06 71C318.43 96.91 271.22 96 256 96 219.55 96 0 100.55 0 208.15v160.23c0 30.27 27.5 57.68 72 77.86v-101.9a24 24 0 1 1 48 0v118.93c33.05 9.11 71.07 15.06 112 16.73V376.39a24 24 0 1 1 48 0V480c40.93-1.67 78.95-7.62 112-16.73V344.34a24 24 0 1 1 48 0v101.9c44.5-20.18 72-47.59 72-77.86V208.15c0-43.32-35.76-69.76-80.66-86.1zM256 272.24c-114.88 0-208-28.69-208-64.09s93.12-64.08 208-64.08c17.15 0 33.73.71 49.68 1.91l-72.81 47a16 16 0 0 0-4.43 22.19l8.87 13.31a16 16 0 0 0 22.19 4.44l118.64-76.52C430.09 168 464 186.84 464 208.15c0 35.4-93.13 64.09-208 64.09z" /></svg>
					</button>
				</td>
			</tr>
			<tr>
				<td>
					<button id="chimbal" class="botao dedo" onclick="playBotaoBateria(this)">
						<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 512 512">
							<g>
								<g>
									<path d="M442.514,210.831c-7.106-1.448-14.575-2.801-22.32-4.061c-46.076,9.44-102.01,16.097-160.96,19.039
								c-21.975,1.098-43.591,1.641-64.477,1.641c-47.447,0-91.162-2.799-126.956-8.254c-6.989-1.064-13.547-2.212-19.702-3.438
								C8.783,226.036,0,236.16,0,238.647c0,2.885,11.713,16.058,69.381,27.816c43.181,8.803,98.697,14.168,158.898,15.425v21.747
								v120.508c0,9.207,7.649,16.67,16.856,16.67c9.207,0,16.856-7.463,16.856-16.67V303.904v-21.742h0
								c68.63-0.297,132.263-5.846,180.606-15.699C500.268,254.705,512,241.532,512,238.647C512,235.762,500.184,222.589,442.514,210.831
								z" />
								</g>
							</g>
							<g>
								<g>
									<path d="M440.871,123.538c-34.736-5.293-77.172-8.009-123.466-8.009c-20.314,0-40.964,0.526-62.636,1.583V95.344V82.059
								c0-6.005-4.832-10.871-10.836-10.871s-10.836,4.867-10.836,10.871v14.516v21.789c-62.61,4.119-120.418,12.439-164.636,23.777
								c-57.011,14.618-68.206,28.365-68.063,31.245c0.144,2.88,12.536,15.45,70.719,24.318c50.153,7.642,116.573,9.913,187.047,6.392
								c70.48-3.521,136.348-12.397,185.49-24.997c57.006-14.617,68.12-28.362,67.978-31.243
								C511.487,144.976,499.053,132.406,440.871,123.538z" />
								</g>
							</g>
						</svg>
					</button>
				</td>
				<td>
					<button id="ride" class="botao dedo" style="display:none">
						@*<svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" viewBox="0 0 32 32">
							<g>
								<path d="M16,9c-1.7,0-3-1.3-3-3s1.3-3,3-3s3,1.3,3,3S17.7,9,16,9z" />
							</g>
							<g>
								<path d="M27,27H8.8c-0.6,0-1-0.4-1-1s0.4-1,1-1h16.4L16,9.9L7.9,23.7C7.6,24.2,7,24.3,6.5,24c-0.5-0.3-0.6-0.9-0.3-1.4l9-15.2 C15.3,7.2,15.6,7,16,7c0.3,0,0.7,0.2,0.9,0.5l11,18c0.2,0.3,0.2,0.7,0,1C27.7,26.8,27.4,27,27,27z" />
							</g>
							<g>
								<path d="M23,30c-0.3,0-0.6-0.1-0.8-0.4l-6-8c-0.3-0.4-0.2-1.1,0.2-1.4c0.4-0.3,1.1-0.2,1.4,0.2l6,8c0.3,0.4,0.2,1.1-0.2,1.4 C23.4,29.9,23.2,30,23,30z" />
							</g>
						</svg>*@
					</button>
					<button id="meiaLua" class="botao dedo" onclick="playBotaoBateria(this)">
						<svg version="1.1" id="Icons" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35" viewBox="0 0 32 32" xml:space="preserve">
						<style type="text/css">
							.st0 {
								fill: none;
								stroke: #000000;
								stroke-width: 2;
								stroke-linejoin: round;
								stroke-miterlimit: 10;
							}

							.st1 {
								fill: none;
								stroke: #000000;
								stroke-width: 2;
								stroke-linecap: round;
								stroke-linejoin: round;
								stroke-miterlimit: 10;
							}
						</style>
						<circle class="st1" cx="16" cy="17" r="11" />
						<circle class="st1" cx="16" cy="6" r="3" />
						<circle class="st1" cx="6.5" cy="11.5" r="3" />
						<circle class="st1" cx="6.5" cy="22.5" r="3" />
						<circle class="st1" cx="25.5" cy="22.5" r="3" />
						<circle class="st1" cx="25.5" cy="11.5" r="3" />
					</svg>
					</button>
				</td>
				<td>
					<button id="prato" class="botao amarelo parar" onclick="pressionarBotao(this, false)">
						<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
							<g>
								<path d="M19,16c-1.7,0-3,1.3-3,3c0,0.9,0.4,1.7,1,2.2V20c0-0.6,0.4-1,1-1h2c0.6,0,1,0.4,1,1v1.2c0.6-0.6,1-1.3,1-2.2 C22,17.3,20.7,16,19,16z" />
								<path d="M19,8C12.9,8,8,12.9,8,19s4.9,11,11,11s11-4.9,11-11S25.1,8,19,8z M21.5,23.3c-0.2,0.1-0.3,0.1-0.5,0.1V26c0,0.6-0.4,1-1,1 h-2c-0.6,0-1-0.4-1-1v-2.4c-1.8-0.8-3-2.6-3-4.6c0-2.8,2.2-5,5-5s5,2.2,5,5C24,20.8,23,22.4,21.5,23.3z" />
								<path d="M6,19c0-7.2,5.8-13,13-13c0.9,0,1.8,0.1,2.7,0.3C19.7,3.6,16.5,2,13,2C6.9,2,2,6.9,2,13c0,3.5,1.6,6.7,4.3,8.7 C6.1,20.8,6,19.9,6,19z" />
							</g>
						</svg>
					</button>
				</td>
			</tr>
		</table>

		<form class="pure-form" id="trackerControls">
			<div class="d-flex align-items-center">
				<label for="bpm">Temp:</label>&nbsp;<input name="bpm" id="bpm" style="width: 50px" value="90" class="form-control">
				&nbsp;
				<button class="btn btn-success" type="button" onclick="clicarUmBotaoTempo(60)">
					60
				</button>
				&nbsp;
				<button class="btn btn-success" type="button" onclick="clicarUmBotaoTempo(70)">
					70
				</button>
				&nbsp;
				<button class="btn btn-success" type="button" onclick="clicarUmBotaoTempo(80)">
					80
				</button>
				&nbsp;
				<button class="btn btn-success" type="button" onclick="clicarUmBotaoTempo(90)">
					90
				</button>
			</div>

			<input id="bpmRange" type="range" class="form-range rangeVerde" max="100" min="50" step="1" value="90">

			<br>

			<div id="options" style="display:none">
				<input class="base" name="sustainAmp" id="sustainAmp" type="range" max="1" min="0" step="0.1" value="0.9"> SustainAmp<br>
				<input class="base" name="decayAmp" id="decayAmp" type="range" max="1" min="0" step="0.1" value="0.9"> DecayAmp<br>
				<input class="base" name="releaseAmp" id="releaseAmp" type="range" max="1" min="0" step="0.1" value="0.9"> ReleaseAmp<br>
				<input class="base" name="attackTime" id="attackTime" type="range" max="1" min="0" step="0.01" value="0.08">Attacktime<br>
				<input class="base" name="decayTime" id="decayTime" type="range" max="1" min="0" step="0.01" value="0.08">DecayTime<br>
				<input class="base" name="sustainTime" id="sustainTime" type="range" max="2" min="0" step="0.1" value="0.1">Sustaintime<br>
				<input class="base" name="releaseTime" id="releaseTime" type="range" max="5" min="0" step="0.1" value="2">Releasetime<br>
				<input class="base" name="adsrInterval" id="adsrInterval" style="width: 60px;" value="0.1">AdsrInterval<br>
				<hr>
				<input class="base" name="delayEnabled" type="checkbox" id="delayEnabled" value="delay"> Enabled delay
				<br>
				<input class="base" name="delay" id="delay" type="range" max="1" min="0" step="0.01" value="0.01"> Delay<br>
				<input class="base" name="filter" id="filter" type="range" max="10000" min="20" step="0.1" value="1000">                Filter<br>
			</div>

		</form>

		<div class="form-check form-switch" id="divBateriaSwitch" style="display:none">
			<input class="form-check-input" type="checkbox" role="switch" id="bateriaSwitch" onchange="showBateria(this.checked)">
			<label for="bateriaSwitch" class="form-check-label" id="textoBateria">Editar Ritmo</label>
		</div>

		<div id="app-message"></div>
		<div id="bateria" style="display:none">
			<div>
				<label for="measureLengthSelect">Compasso:</label>
				<select name="measureLengthSelect" id="measureLengthSelect" aria-label="Compasso">
					<option value="6">3/4</option>
					<option selected value="8">4/4</option>
					<option value="12">6/8</option>
				</select>
				<input class="base" name="measureLength" id="measureLength" style="width: 60px;" value="16">
			</div>

			<div id="tracker-parent">
				<table id="tracker-table">
				</table>
			</div>
			<div id="tracker-controls">
				<div style="display:none">
					<button id="play">Play</button>
					<button id="pause">Pause</button>
					<button id="stop">Stop</button>
					<br>
				</div>
			</div>
			<br />
			<button onclick="escreverRitmo()">Get Ritmo</button>
			<div id="textoRitmo"></div>

			<div style="display:none">
				<hr>
				<form class="pure-form">
					<input type="text" id="filename"><br>
					<button id="save">Save as </button><button id="saveAsJson">Get JSON</button> <br>

					<span id="load-storage"><select id="beat-list"><option value="Select">Select</option></select></span>
					<button id="delete">Delete selected</button>
				</form>
			</div>
		</div>
	</div>
</div>
<script>
	var div = document.getElementById('bateria');
	var selecionarRitmoElem = document.getElementById("selecionarRitmo");
	const ritmosJson = JSON.parse('@Html.Raw(@Model.RitmosBateria)');

	function showBateria(mostrarBateria) {
		if (mostrarBateria) {
			document.getElementById('container').classList.remove('container');
			document.getElementById('textoBateria').style.color = 'black';
			div.style.display = 'block';
		}
		else {
			document.getElementById('container').classList.add('container');
			div.style.display = 'none';
			document.getElementById('textoBateria').style.color = 'grey';
		}
	}

	function clicarUmBotaoTempo(tempoValor) {
		var bpmElement = document.getElementById('bpm');
		document.getElementById('bpmRange').value = tempoValor;
		bpmElement.value = tempoValor;

		var novoEvento = new Event('change');
		bpmElement.dispatchEvent(novoEvento);
	}

	function escreverRitmo() {
		var tabelaElem = document.getElementById('tracker-table');
		var elementos = document.getElementsByClassName('tracker-enabled');
		var texto = '';

		Array.from(elementos).forEach((elemento) => {
			texto += elemento.innerText + ', ';
		});

		document.getElementById('textoRitmo').innerText = texto;
	}

	function playBotaoBateria(botao, tocar = true, levantarBotoes = true) {
		pressionarBotao(botao, levantarBotoes);

		//var prepararBateriaBotao = document.getElementById('prepararBateriaBotao');
		//var pararBateriaBotao = document.getElementById('pararBateriaBotao');

		//if (prepararBateriaBotao.style.display == 'none' || tocar == false) {
		//	prepararBateriaBotao.style.display = '';
		//	pararBateriaBotao.style.display = 'none';
		//}
		//else {
		//	prepararBateriaBotao.style.display = 'none';
		//	pararBateriaBotao.style.display = '';
		//}
	}

	function pressionarBotao(botao, levantarBotoes = true) {
		var prepararBateriaBotao = document.getElementById('prepararBateriaBotao');
		var pararBateriaBotao = document.getElementById('pararBateriaBotao');
		var playPauseBateria = document.getElementById('play-pause_bateria');

		var botaoPressionadoAntes = document.getElementsByClassName('selecionadoDrum');
		var botaoPressionado = botaoPressionadoAntes.length > 0 ? botaoPressionadoAntes[0] : null;

		if (botao.id !== 'prato') {
			if (prepararBateriaBotao.style.display !== 'none') {
				prepararBateriaBotao.style.display = 'none';
				pararBateriaBotao.style.display = '';
			}
		}

		if (levantarBotoes && botaoPressionado) {
			if (botao === botaoPressionado) {
				fazerViradaBateria();
			} else {
				botaoPressionado.classList.remove('selecionadoDrum');
			}
		}

		if (botao === playPauseBateria) {
			prepararBateriaBotao.style.display = '';
			pararBateriaBotao.style.display = 'none';
		} else if (botao.id !== 'prato') {
			botao.classList.add('selecionadoDrum');
		}
	}

</script>
