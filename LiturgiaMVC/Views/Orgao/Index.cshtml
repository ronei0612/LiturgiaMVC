@model LinksModel

@{
    ViewData["Title"] = "Órgão";
	Layout = "~/Views/Orgao/_Layout.cshtml";
}

<style>
	table {
		margin: 0 auto;
	}
</style>

<div id="tracker-container" style="display:none">
	<div id="container" class="container d-sm-flex" style="display:none">
		<div class="box" id="orgaoBox">
			<div id="linhaSelectTom" class="d-flex align-items-center centralizado-no-container">
				<div class="d-flex align-items-center">
					&nbsp;
						
					<div class="d-flex">
						<input class="btn btn-link" type="button" id="voltar" value="&laquo; Voltar" onclick="voltarParaOrgao()" style="display:none">
						&nbsp;
						<button class="btn btn-light border" type="button" id="botaoFonte" style="display:none" onclick="showselectFonte(true)">
							<svg width="24" height="24" viewBox="0 0 24 24" version="1.1">
								<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
									<g id="ic_fluent_text_font_size_24_filled" fill="#212121" fill-rule="nonzero">
										<path d="M9.96973134,16.1676988 L14.5597933,3.65629281 C14.8658898,2.82190042 16.0062636,2.7839735 16.3882035,3.54251203 L16.4374349,3.65629281 L21.9389727,18.6530071 C22.1291829,19.1715035 21.8630543,19.7460237 21.3445578,19.9362339 C20.8630969,20.1128576 20.3333297,19.8960056 20.1078122,19.4489883 L20.0613311,19.3418191 L18.6507313,15.4986988 L12.3457313,15.4986988 L10.9040947,19.4185072 L10.9040947,19.4185072 L10.8631472,19.4974307 L10.8631472,19.4974307 L10.7910689,19.6055793 L10.7910689,19.6055793 L10.7134865,19.6954421 L10.7134865,19.6954421 L10.6286155,19.7731048 L10.6286155,19.7731048 L10.5461422,19.8334381 L10.5461422,19.8334381 L10.4957113,19.8642525 L10.4957113,19.8642525 L10.411619,19.9074431 L10.411619,19.9074431 L10.3076065,19.9480193 L10.3076065,19.9480193 L10.2029659,19.9761277 L10.2029659,19.9761277 L10.0696716,19.9950212 L10.0696716,19.9950212 L9.96236211,19.997081 L9.96236211,19.997081 L9.89175982,19.9920615 L9.89175982,19.9920615 L9.78921006,19.9756858 L9.78921006,19.9756858 L9.63922865,19.9311953 L9.63922865,19.9311953 L9.56990029,19.901584 L9.56990029,19.901584 L9.46987671,19.8472224 L9.46987671,19.8472224 L9.35831456,19.7671539 L9.35831456,19.7671539 L9.26665026,19.680721 L9.26665026,19.680721 L9.20269015,19.6050585 L9.20269015,19.6050585 L9.14144021,19.5150962 L9.14144021,19.5150962 L9.08735353,19.4126293 L9.08735353,19.4126293 L8.34173134,17.4996988 L4.65473134,17.4996988 L3.93200399,19.3598611 C3.74612765,19.8378261 3.23314027,20.091838 2.74868178,19.9654159 L2.63755197,19.9294171 C2.15958693,19.7435407 1.90557508,19.2305533 2.03199719,18.7460949 L2.06799601,18.634965 L5.56653421,9.63877441 C5.88137646,8.82918461 6.9873796,8.79063271 7.37757051,9.52311873 L7.43054218,9.63877441 L9.96973134,16.1676988 L14.5597933,3.65629281 L9.96973134,16.1676988 Z M6.49853819,12.7602387 L5.43273134,15.4996988 L7.56373134,15.4996988 L6.49853819,12.7602387 Z M15.4986141,6.90424881 L13.0787313,13.4986988 L17.9167313,13.4986988 L15.4986141,6.90424881 Z">
										</path>
									</g>
								</g>
							</svg>
						</button>
						<select class="form-control" id="selectFonte" onchange="showselectFonte(false)" style="display:none">
							<option value="11">11</option>
							<option value="12">12</option>
							<option value="13">13</option>
							<option value="14" selected>14</option>
							<option value="15">15</option>
							<option value="16">16</option>
							<option value="17">17</option>
							<option value="18">18</option>
						</select>
						&nbsp;
						<button class="btn btn-primary" type="button" ondblclick="aumentarTom_clickDuplo(false)" onclick="aumentarTom_click(false)">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-dash-lg" viewBox="0 0 16 16">
								<path fill-rule="evenodd" d="M2 8a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11A.5.5 0 0 1 2 8" />
							</svg>
						</button>
							&nbsp;
						<select class="form-control" id="tomSelect" onchange="prepararMudarTomCifra(this.value)" onclick="pegarTomCifra(this.value)" style="text-align-last:center">
							@foreach (var tom in Model.TonsMaiores)
							{
								<option value="@tom">@tom</option>
							}
						</select>
						&nbsp;
						<button class="btn btn-primary" type="button" ondblclick="aumentarTom_clickDuplo(true)" onclick="aumentarTom_click(true)">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">
								<path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2" />
							</svg>
						</button>
					</div>

				</div>
				&nbsp;
				<div class="form-check form-switch" id="tomMenorSwitchDiv">
					<input class="form-check-input" type="checkbox" role="switch" id="tomMenorSwitch" onchange="selecionarTomMenor(this.checked)">
					<label for="tomMenorSwitch" class="form-check-label" id="textoAcordeMenor">
						@Model.TonsMenores[(int)Model.TomIndex]
					</label>
				</div>
				&nbsp;
				<button class="btn btn-light border-primary" type="button" onclick="" style="display:none">
					<span style="color:#85AFEB">▲▼</span>
				</button>
			</div>

			<div id="textoCifrasFrame" style="display:none">
				<iframe id="textoCifras" style="width:100%"></iframe>
			</div>

			<table>
				<partial name="~/Views/Orgao/Controles.cshtml" />
				<partial name="~/Views/Orgao/Botoes.cshtml" />
				<partial name="~/Views/Orgao/Loading.cshtml" />
			</table>
		</div>

		<div class="box" id="bateriaBox">
			<partial name="~/Views/Bateria/Index.cshtml" />
		</div>
	</div>
</div>

<script src="~/js/Pizzicato.min.js" asp-append-version="true"></script>

<script>
	const notasAcordesJson = JSON.parse('@Html.Raw(@Model.NotasAcordes)');
	const acordesCampoHarmonicoJson = JSON.parse('@Html.Raw(@Model.AcordesCampoHarmonico)');
	const acidentesCorrespondentesJson = JSON.parse('@Html.Raw(@Model.AcidentesCorrespondentes)');
	const acordesTons = Object.keys(acordesCampoHarmonicoJson);
	const tonsMaiores = '@Html.Raw(@Model.TonsMaioresString)'.split(', ');
	const tonsMenores = '@Html.Raw(@Model.TonsMenoresString)'.split(', ');
	
	esperarAudios(1000, true);

	var acordes = {
		'orgao_do': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_do"])', loop: true, release: 0.5, attack: 0.2 } }),
		'orgao_do#': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_do#"])', loop: true, release: 0.5, attack: 0.2 } }),
		'orgao_re': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_re"])', loop: true, release: 0.5, attack: 0.2 } }),
		'orgao_re#': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_re#"])', loop: true, release: 0.5, attack: 0.2 } }),
		'orgao_mi': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_mi"])', loop: true, release: 0.5, attack: 0.2 } }),
		'orgao_fa': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_fa"])', loop: true, release: 0.5, attack: 0.2 } }),
		'orgao_fa#': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_fa#"])', loop: true, release: 0.5, attack: 0.2 } }),
		'orgao_sol': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_sol"])', loop: true, release: 0.5, attack: 0.2 } }),
		'orgao_sol#': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_sol#"])', loop: true, release: 0.5, attack: 0.2 } }),
		'orgao_la': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_la"])', loop: true, release: 0.5, attack: 0.2 } }),
		'orgao_la#': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_la#"])', loop: true, release: 0.5, attack: 0.2 } }),
		'orgao_si': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_si"])', loop: true, release: 0.5, attack: 0.2 } }),
		
		'orgao_do_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_do_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
		'orgao_do#_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_do#_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
		'orgao_re_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_re_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
		'orgao_re#_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_re#_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
		'orgao_mi_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_mi_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
		'orgao_fa_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_fa_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
		'orgao_fa#_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_fa#_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
		'orgao_sol_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_sol_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
		'orgao_sol#_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_sol#_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
		'orgao_la_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_la_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
		'orgao_la#_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_la#_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
		'orgao_si_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["orgao_si_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),

		'strings_C': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_do"])', loop: true, release: 0.5, attack: 0.2 } }),
		'strings_C#': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_do#"])', loop: true, release: 0.5, attack: 0.2 } }),
		'strings_D': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_re"])', loop: true, release: 0.5, attack: 0.2 } }),
		'strings_D#': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_re#"])', loop: true, release: 0.5, attack: 0.2 } }),
		'strings_E': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_mi"])', loop: true, release: 0.5, attack: 0.2 } }),
		'strings_F': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_fa"])', loop: true, release: 0.5, attack: 0.2 } }),
		'strings_F#': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_fa#"])', loop: true, release: 0.5, attack: 0.2 } }),
		'strings_G': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_sol"])', loop: true, release: 0.5, attack: 0.2 } }),
		'strings_G#': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_sol#"])', loop: true, release: 0.5, attack: 0.2 } }),
		'strings_A': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_la"])', loop: true, release: 0.5, attack: 0.2 } }),
		'strings_A#': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_la#"])', loop: true, release: 0.5, attack: 0.2 } }),
		'strings_B': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_si"])', loop: true, release: 0.5, attack: 0.2 } }),

		'strings_C_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_do_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
		'strings_C#_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_do#_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
		'strings_D_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_re_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
		'strings_D#_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_re#_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
		'strings_E_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_mi_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
		'strings_F_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_fa_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
		'strings_F#_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_fa#_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
		'strings_G_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_sol_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
		'strings_G#_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_sol#_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
		'strings_A_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_la_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
		'strings_A#_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_la#_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
		'strings_B_baixo': new Pizzicato.Sound({ source: 'file', options: { path: '@Html.Raw(@Model.LinksDict["strings_si_baixo"])', loop: true, release: 0.5, attack: 0.2 } }),
	};

	function voltarParaOrgao() {
		document.getElementById('voltar').style.display = 'none';
		document.getElementById('botaoFonte').style.display = 'none';
		document.getElementById('selectFonte').style.display = "none";

		document.getElementById('textoCifrasFrame').style.display = 'none';
		document.getElementById('cifraAvancar').style.display = 'none';
		document.getElementById('cifraRetroceder').style.display = 'none';
		document.getElementById('tomMenorSwitchDiv').style.display = '';

		var elements = document.getElementsByClassName('orgaoBotoes');
		for (var i = 0; i < elements.length; i++) {
			elements[i].style.display = '';
		};

		document.getElementById('volumeDiv').style.display = 'flex';
		document.getElementById('container').classList.add('d-sm-flex');
	}

	function mudarParaFullscreen() {
		document.getElementById('exitfullscreen').style.display = 'flex';
		document.getElementById('fullscreen').style.display = 'none';
		document.getElementById('trackerControls').style.display = 'none';
		document.getElementById('divBateriaSwitch').style.display = 'none';
		document.getElementById('bateria').style.display = 'none';

		if (document.getElementById('textoCifrasFrame').style.display != 'none') {
			var linhaSelectTom = document.getElementById('linhaSelectTom');
			linhaSelectTom.style.display = 'none';
			linhaSelectTom.classList.remove('d-flex');
		}

		var el = document.body;
		var requestMethod = el.requestFullScreen || el.webkitRequestFullScreen
			|| el.mozRequestFullScreen || el.msRequestFullScreen;

		if (requestMethod)
			requestMethod.call(el);

		document.getElementById('navBar').style.display = 'none';
	}

	function sairDeFullscreen() {
		document.getElementById('exitfullscreen').style.display = 'none';
		document.getElementById('trackerControls').style.display = 'block';
		document.getElementById('fullscreen').style.display = 'flex';
		document.exitFullscreen();
		document.getElementById('navBar').style.display = 'block';

		linhaSelectTom.classList.add('d-flex');
		document.getElementById('linhaSelectTom').style.display = 'flex';
	}

	function esperarAudios(tempoMiliseg, esperar_audios) {
		if (esperar_audios == false) {
			document.getElementById('container').style.display = 'block';
			document.getElementById('tracker-container').style.display = 'block';
		}
		else
			setTimeout(function () {
				document.getElementById('container').style.display = 'block';
				document.getElementById('tracker-container').style.display = 'block';
		}, tempoMiliseg)
	}

	function deixarTomSelecionado(tom) {
		document.getElementById('tomSelect').value = tom;
	}

	function selecionarTomMenor(selecionadoMenor) {
		if (selecionadoMenor) {
			document.getElementById('textoAcordeMenor').style.color = 'black';
			document.getElementById('tomSelect').style.color = 'grey';
			document.getElementById('acorde_10').style.display = 'block';
			document.getElementById('acorde_7').style.display = 'block';
			document.getElementById('acorde_9').style.display = 'block';
		}
		else {
			document.getElementById('textoAcordeMenor').style.color = 'grey';
			document.getElementById('tomSelect').style.color = 'black';
			document.getElementById('acorde_10').style.display = 'none';
			document.getElementById('acorde_7').style.display = 'none';
			document.getElementById('acorde_9').style.display = 'none';
		}
	}

	var timer;
	var _tomIndex = '';

	function aumentarTom_click(aumentar) {
		if (timer)
			clearTimeout(timer);
		timer = setTimeout(function () {
			aumentarTom(aumentar, 1, "tomSelect");
		}, 240);
	}

	function aumentarTom_clickDuplo(aumentar) {
		clearTimeout(timer);
		aumentarTom(aumentar, 2, "tomSelect");
	}

	function showselectFonte(mostrar) {
		if (mostrar) {
			document.getElementById('botaoFonte').style.display = "none";
			document.getElementById('selectFonte').style.display = "";
		}
		else {
			var selectFonte = document.getElementById('selectFonte');
			var frameCifra = document.getElementById('textoCifras');
			frameCifra.contentWindow.document.querySelector('pre').style.fontSize = selectFonte.value + 'px';
		}
	}

	function prepararMudarTomCifra(tomSelecionado) {
		if (document.getElementById('textoCifrasFrame').style.display == "none")
			mudarTom(tomSelecionado);

		else {
			if (tomSelecionado.includes('m'))
				var index = tonsMenores.indexOf(tomSelecionado);
			else
				var index = tonsMaiores.indexOf(tomSelecionado);

			index = index - _tomIndex;

			if (index < 0)
				mudarTomCifra(false, Math.abs(index));
			else
				mudarTomCifra(true, index);
		}
	}

	function pegarTomCifra(tomSelecionado) {
		if (tomSelecionado.includes('m'))
			_tomIndex = tonsMenores.indexOf(tomSelecionado);
		else
			_tomIndex = tonsMaiores.indexOf(tomSelecionado);
	}
</script>