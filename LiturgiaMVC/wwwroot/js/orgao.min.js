var _grupoNotas, _grupoNotasStrings, _acordeSelecionado = "", _acordeAntesSelecionado = "", _acompanhamentoSelecionado = "", _acompanhamentoSolo = !1, _acompanhamentoFull = !1, _acompanhamentoMao = !1, _volume = .9, _instrumentoSelecionado = "orgao"; const notasAcordes = Object.keys(notasAcordesJson); var tremolo = new Pizzicato.Effects.Tremolo({ speed: 1, depth: .6, mix: .8 }), flanger = new Pizzicato.Effects.Flanger({ time: .45, speed: .2, depth: .1, feedback: .1, mix: .2 }), pingPongDelay = new Pizzicato.Effects.PingPongDelay({ feedback: .6, time: .4, mix: .5 }); function deixarAcompanhamentoSelecionado(e) { escolherAcompanhamento(e, document.getElementById(e)) } function ocultarBotaoRec(e = !0) { e ? (document.getElementById("gravar").style.display = "none", document.getElementById("play-pause").style.display = "block") : (document.getElementById("gravar").style.display = "block", document.getElementById("play-pause").style.display = "none") } function escolherAcorde(e, o) { _acordeSelecionado = _acordeAntesSelecionado == e ? "" : e, o && levantarBotoesAcordes(), "" == _acordeSelecionado ? (_acordeAntesSelecionado = _acordeSelecionado, pararOsAcordes(), o && ocultarBotaoRec(!1)) : (tocarAcorde(e, o), o && ocultarBotaoRec()) } function escolherAcompanhamento(e, o) { _acompanhamentoSelecionado = e, pressionarBotaoAcompanhamento(o) } function tocarAcorde(e, o) { _acordeAntesSelecionado != e && (o ? ("" != o.value ? verificarAcompanhamentoEtocar(o.value) : verificarAcompanhamentoEtocar(e), o.classList.toggle("pressionado", !0)) : verificarAcompanhamentoEtocar(e)) } function setTom(e = "C") { document.getElementById("tomSelect").value = e } function montarAcorde(e, o, a = !1) { if (e.includes("_") && (e = e.split("_")[1]), a) e = e.replace("m", "").replace("7", ""), e = acidentesCorrespondentesJson[e], ("full" == _acompanhamentoSelecionado || "baixo" == _acompanhamentoSelecionado) && o.addSound(acordes["strings_" + e + "_baixo"]), ("full" == _acompanhamentoSelecionado || "mao" == _acompanhamentoSelecionado) && o.addSound(acordes["strings_" + e]); else for (var t = notasAcordesJson[e], n = 0, r = t.length; n < r; n++)("full" == _acompanhamentoSelecionado || "baixo" == _acompanhamentoSelecionado) && 1 != n && o.addSound(acordes["orgao_" + t[n] + "_baixo"]), ("full" == _acompanhamentoSelecionado || "mao" == _acompanhamentoSelecionado) && o.addSound(acordes["orgao_" + t[n]]); return o } function verificarGrupoNotasInstanciado(e, o = !0) { return null == e && (e = new Pizzicato.Group, o && e.addEffect(flanger), e.volume = _volume), e } function verificarAcompanhamentoEtocar(e) { pararOsAcordes(!0), _acordeAntesSelecionado = e, "orgao" == _instrumentoSelecionado ? (_grupoNotas = montarAcorde(e, _grupoNotas = verificarGrupoNotasInstanciado(_grupoNotas))).play() : "orgaopad" == _instrumentoSelecionado ? (_grupoNotas = montarAcorde(e, _grupoNotas = verificarGrupoNotasInstanciado(_grupoNotas)), (_grupoNotasStrings = montarAcorde(e, _grupoNotasStrings = verificarGrupoNotasInstanciado(_grupoNotasStrings, !1), !0)).play(), _grupoNotas.play()) : "strings" == _instrumentoSelecionado && (_grupoNotasStrings = montarAcorde(e, _grupoNotasStrings = verificarGrupoNotasInstanciado(_grupoNotasStrings, !1), !0)).play() } function pararOsAcordes(e = !1) { if (null != _grupoNotas && (_grupoNotas.stop(), e)) { var o = _grupoNotas.sounds.length; for (let a = o - 1; a > -1; a--)_grupoNotas.removeSound(_grupoNotas.sounds[a]) } if (null != _grupoNotasStrings && (_grupoNotasStrings.stop(), e)) { var o = _grupoNotasStrings.sounds.length; for (let t = o - 1; t > -1; t--)_grupoNotasStrings.removeSound(_grupoNotasStrings.sounds[t]) } } function levantarBotoesAcordes() { var e = document.getElementsByClassName("pressionado"); e.length > 0 && e[0].classList.toggle("pressionado", !1) } function levantarBotoesAcompanhamento() { var e = document.getElementsByClassName("selecionado"); for (let o = 0; o < e.length; o++)e[o].classList.toggle("selecionado", !1) } function pressionarBotaoAcompanhamento(e) { !1 == botaoAcompPressionado(e) && ("" != _acordeAntesSelecionado && verificarAcompanhamentoEtocar(_acordeAntesSelecionado), levantarBotoesAcompanhamento(), pressionarBotaoAcomp(e)) } function botaoAcompPressionado(e) { return !!e.classList.contains("selecionado") } function pressionarBotaoAcomp(e) { e.classList.toggle("selecionado", !0) } function alterarVolume(e, o) { _volume = parseFloat(e), null != _grupoNotas && (_grupoNotas.volume = _volume), null != _grupoNotasStrings && (_grupoNotasStrings.volume = _volume); var a = document.getElementById("volumeTexto"); e == o ? a.innerHTML = 10 * e : a.innerHTML = 10 * e + "*" } function mudarTomCifra(e, o) { var a = document.getElementById("textoCifras").contentDocument.body.innerHTML; $.ajax({ type: "post", url: "Orgao/AlterarTom", data: { texto: a, aumentar: e, quant: o }, success: function (e) { if (e.success) { var o = document.getElementById("textoCifras"); o.contentDocument.body.innerHTML = e.message, addEventCifras(o) } else alert(e.message) } }) } function mudarTom(e) { var o = acordesCampoHarmonicoJson[e]; Array.from(document.getElementsByClassName("acorde")).forEach(e => { var a = e.id.split("_")[1]; e.value = o[a] }); var a = document.getElementsByClassName("pressionado"); if (a.length > 0) { var t = a[0]; escolherAcorde("orgao_" + t.value, t) } mudarTomMenor(document.getElementById("tomSelect").selectedIndex) } function mudarTomMenor(e) { document.getElementById("textoAcordeMenor").innerText = acordesTons[e + 12] } function aumentarTom(e, o, a) { var t = document.getElementById(a), n = t.selectedIndex; e ? n + o == t.length ? t.value = tonsMaiores[0] : n + o > t.length ? t.value = tonsMaiores[-1 + o] : t.value = tonsMaiores[n + o] : n - o < 0 ? 0 == n ? t.value = tonsMaiores[t.length - o] : t.value = tonsMaiores[t.length - 1] : t.value = tonsMaiores[n - o], "tomSelectCifra" == a ? mudarTomCifra(e, o) : mudarTom(t.value) } function mostrarTextoArquivoCarregado(e, o) { document.getElementById("tomSelectCifra").selectedIndex = acordesTons.indexOf(e); var a = document.getElementById("textoCifras"); a.contentDocument.body.innerHTML = o, addEventCifras(a) } function addEventCifras(e) { for (var o = e.contentDocument.getElementsByTagName("b"), a = 0; a < o.length; a++)o[a].addEventListener("click", function (e) { var o = document.getElementById("textoCifras").contentDocument.getElementsByClassName("cifraSelecionada"); o.length > 0 && o[0].classList.remove("cifraSelecionada"), e.target.classList.add("cifraSelecionada"), e.target.scrollIntoView(), parent.tocarCifraManualmente(e.target) }) } function tocarCifraManualmente(e) { cifraId = e.id.split("cifra")[1] - 1 } deixarAcompanhamentoSelecionado("full"); var cifraId = 0; function avancarCifra(e, o) { if ("" == e) escolherAcorde("", o); else { var a = document.getElementById("textoCifras"), t = a.contentDocument, n = t.getElementsByTagName("b"), a = document.getElementById("textoCifras"), r = t.getElementsByClassName("cifraSelecionada"); if (r.length > 0 && r[0].classList.remove("cifraSelecionada"), "avancar" == e && cifraId < n.length) { var s = n[cifraId]; tocarAcorde(s.innerHTML.trim(), null), o.classList.toggle("pressionado", !0), s.classList.add("cifraSelecionada"), s.scrollIntoView(), cifraId++ } if ("retroceder" == e && cifraId > 0) { var s = n[--cifraId - 1]; tocarAcorde(s.innerHTML.trim(), null), o.classList.toggle("pressionado", !0), s.classList.add("cifraSelecionada"), s.scrollIntoView() } } } document.getElementById("instrumentoSelect").addEventListener("change", e => { var o; _instrumentoSelecionado = document.getElementById("instrumentoSelect").value.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase() });