var _grupoNotas,_grupoNotasStrings,_acordeSelecionado="",_acordeAntesSelecionado="",_acompanhamentoSelecionado="",_acompanhamentoSolo=!1,_acompanhamentoFull=!1,_acompanhamentoMao=!1,_volume=.9,_instrumentoSelecionado="orgao",_stringsSelecionado=!1,_stringsParado=!0,_autoMudarRitmo=!1;const notasAcordes=Object.keys(notasAcordesJson);var tremolo=new Pizzicato.Effects.Tremolo({speed:1,depth:.6,mix:.8}),flanger=new Pizzicato.Effects.Flanger({time:.45,speed:.2,depth:.1,feedback:.1,mix:.2}),pingPongDelay=new Pizzicato.Effects.PingPongDelay({feedback:.6,time:.4,mix:.5}),delay=new Pizzicato.Effects.Delay({feedback:.5,time:.33,mix:.1});function deixarAcompanhamentoSelecionado(e){escolherAcompanhamento(e,document.getElementById(e))}function ocultarBotaoRec(e=!0){e?(document.getElementById("gravar").style.display="none",document.getElementById("play-pause").style.display="block"):(document.getElementById("gravar").style.display="block",document.getElementById("play-pause").style.display="none")}function escolherAcorde(e,o){_cifraId>0&&(_cifraParado=!0,_cifraId--),_acordeSelecionado=_acordeAntesSelecionado==e?"":e,o&&levantarBotoesAcordes(),""==_acordeSelecionado?(_acordeAntesSelecionado=_acordeSelecionado,pararOsAcordes(),o&&ocultarBotaoRec(!1)):(tocarAcorde(e,o),o&&ocultarBotaoRec())}function autoMudarRitmo(e=null){if("none"!==document.getElementById("pararBateriaBotao").style.display&&_autoMudarRitmo){var o=new Event("click"),a=e||document.querySelector(".selecionado");_stringsSelecionado?("solo"===a.id||"mao"===a.id)&&"epiano"===_instrumentoSelecionado?document.getElementById("chimbal").dispatchEvent(o):("solo"===a.id||"mao"===a.id)&&"orgao"===_instrumentoSelecionado?document.getElementById("brush").dispatchEvent(o):"full"===a.id&&"epiano"===_instrumentoSelecionado?document.getElementById("meiaLua").dispatchEvent(o):"full"===a.id&&"orgao"===_instrumentoSelecionado&&document.getElementById("aro").dispatchEvent(o):("solo"===a.id||"mao"===a.id)&&"epiano"===_instrumentoSelecionado?document.getElementById("aro").dispatchEvent(o):("solo"===a.id||"mao"===a.id)&&"orgao"===_instrumentoSelecionado?document.getElementById("brush").dispatchEvent(o):"full"===a.id&&"epiano"===_instrumentoSelecionado?document.getElementById("caixa").dispatchEvent(o):"full"===a.id&&"orgao"===_instrumentoSelecionado&&document.getElementById("aro").dispatchEvent(o)}}function escolherAcompanhamento(e,o){_acompanhamentoSelecionado=e,pressionarBotaoAcompanhamento(o),autoMudarRitmo(o)}function tocarAcorde(e,o){o?(""!=o.value?verificarAcompanhamentoEtocar(o.value):verificarAcompanhamentoEtocar(e),o.classList.toggle("pressionado",!0)):verificarAcompanhamentoEtocar(e)}function setTom(e="C"){document.getElementById("tomSelect").value=e}function montarAcorde(e,o,a="orgao"){if("stringsSolo"==a&&_stringsSelecionado&&(a="strings"),e.includes("_")&&(e=e.split("_")[1]),e.length>1&&"b"==e[1]){var t=e[0]+e[1];e=e.replace(t,acidentesCorrespondentesJson[e[0]+e[1]])}if(null!=o){var n=notasAcordesJson[e];if("stringsSolo"==a)o.addSound(acordes["strings_"+n[0]+"_baixo"]),o.addSound(acordes["strings_"+n[0]+"_grave"]);else for(var r=0,s=n.length;r<s;r++)("full"==_acompanhamentoSelecionado||"baixo"==_acompanhamentoSelecionado)&&(0==r&&o.addSound(acordes[a+"_"+n[r]+"_grave"]),o.addSound(acordes[a+"_"+n[r]+"_baixo"])),("full"==_acompanhamentoSelecionado||"mao"==_acompanhamentoSelecionado)&&("stringsSolo"==a?o.addSound(acordes["strings_"+n[0]]):o.addSound(acordes[a+"_"+n[r]]))}return o}function verificarGrupoNotasInstanciado(e,o=null){return null==e&&((e=new Pizzicato.Group).volume=_volume),o?0==e.effects.length&&e.addEffect(o):e.effects.length>0&&e.removeEffect(e.effects[0]),e}function verificarAcompanhamentoEtocar(e,o=0){_acordeAntesSelecionado==e?(pararOsAcordes(!0,!0),o=50):pararOsAcordes(!0),setTimeout(function(){_acordeAntesSelecionado=e,"strings"==_instrumentoSelecionado?(_grupoNotasStrings=montarAcorde(e,_grupoNotasStrings=verificarGrupoNotasInstanciado(_grupoNotasStrings),"stringsSolo")).play():((_grupoNotas=montarAcorde(e,_grupoNotas="epiano"==_instrumentoSelecionado?verificarGrupoNotasInstanciado(_grupoNotas,delay):verificarGrupoNotasInstanciado(_grupoNotas),_instrumentoSelecionado)).play(),_stringsSelecionado&&(_stringsParado||_grupoNotas.sounds.length<10)&&(_stringsParado=!1,(_grupoNotasStrings=montarAcorde(e,_grupoNotasStrings=verificarGrupoNotasInstanciado(_grupoNotasStrings),"strings")).play()))},o)}function pararOsAcordes(e=!1,o=!1){if(null!=_grupoNotas&&(_grupoNotas.stop(),e)){var a=_grupoNotas.sounds.length;for(let t=a-1;t>-1;t--)_grupoNotas.removeSound(_grupoNotas.sounds[t])}if(!1==o&&null!=_grupoNotasStrings&&(_stringsParado=!0,_grupoNotasStrings.stop(),e)){var a=_grupoNotasStrings.sounds.length;for(let n=a-1;n>-1;n--)_grupoNotasStrings.removeSound(_grupoNotasStrings.sounds[n])}}function levantarBotoesAcordes(){var e=document.getElementsByClassName("pressionado");e.length>0&&e[0].classList.toggle("pressionado",!1)}function levantarBotoesAcompanhamento(){var e=document.getElementsByClassName("selecionado");for(let o=0;o<e.length;o++)e[o].classList.toggle("selecionado",!1)}function pressionarBotaoAcompanhamento(e){!1==botaoAcompPressionado(e)&&(""!=_acordeAntesSelecionado&&"epiano"!=_instrumentoSelecionado&&verificarAcompanhamentoEtocar(_acordeAntesSelecionado),levantarBotoesAcompanhamento(),pressionarBotaoAcomp(e))}function botaoAcompPressionado(e){return!!e.classList.contains("selecionado")}function pressionarBotaoAcomp(e){e.classList.toggle("selecionado",!0)}function alterarVolume(e,o){_volume=parseFloat(e),null!=_grupoNotas&&(_grupoNotas.volume=_volume),null!=_grupoNotasStrings&&(_grupoNotasStrings.volume=_volume),e==o?document.getElementById("volumeTexto").innerHTML=10*e:document.getElementById("volumeTexto").innerHTML=10*e+"*"}function mudarTomCifra(e,o){var a=document.getElementById("textoCifras").contentDocument.body.innerHTML;$.ajax({type:"post",url:"Orgao/AlterarTom",data:{texto:a,aumentar:e,quant:o},success:function(e){if(e.success){var o=document.getElementById("textoCifras");o.contentDocument.body.innerHTML=e.message,addEventCifras(o)}else alert(e.message)}})}function mudarTom(e){var o=acordesCampoHarmonicoJson[e];Array.from(document.getElementsByClassName("acorde")).forEach(e=>{var a=e.id.split("_")[1];e.value=o[a]});var a=document.getElementsByClassName("pressionado");if(a.length>0){var t=a[0];escolherAcorde("orgao_"+t.value,t)}mudarTomMenor(document.getElementById("tomSelect").selectedIndex)}function mudarTomMenor(e){document.getElementById("textoAcordeMenor").innerText=acordesTons[e+12]}function aumentarTom(e,o,a){var t=document.getElementById(a),n=t.selectedIndex;if(t.value.includes("m"))var r=tonsMenores;else var r=tonsMaiores;e?n+o==t.length?t.value=r[0]:n+o>t.length?t.value=r[-1+o]:t.value=r[n+o]:n-o<0?0==n?t.value=r[t.length-o]:t.value=r[t.length-1]:t.value=r[n-o],"block"==document.getElementById("textoCifrasFrame").style.display?mudarTomCifra(e,o):mudarTom(t.value)}function adicionarTonsSelect(e,o,a){var t=document.getElementById(e);t.innerHTML="";var n=tonsMaiores;!1==a&&(n=tonsMenores);for(var r=0;r<n.length;r++){let s=document.createElement("option");s.value=n[r],s.textContent+=n[r],t.appendChild(s)}t.selectedIndex=o}function mostrarTextoArquivoCarregado(e=null,o=null){e&&(e.includes("m")?adicionarTonsSelect("tomSelect",tonsMenores.indexOf(e),!1):adicionarTonsSelect("tomSelect",tonsMaiores.indexOf(e),!0));var a=document.getElementById("textoCifras"),t=document.getElementById("textoCifrasFrame");if(o&&(a.contentDocument.body.innerHTML=o),document.body.classList.contains("bg-dark")?a.contentWindow.document.querySelector("pre").style.color="#fff":a.contentWindow.document.querySelector("pre").style.color="#000","none"==t.style.display){t.style.display="block";for(var n=document.getElementsByClassName("orgaoBotoes"),r=0;r<n.length;r++)n[r].style.display="none";document.getElementById("container").classList.remove("d-sm-flex"),document.getElementById("volumeDiv").style.display="none",document.getElementById("voltar").style.display="block",document.getElementById("botaoFonte").style.display="block",document.getElementById("selectFonte").style.display="none",document.getElementById("tomMenorSwitchDiv").style.display="none",document.getElementById("orgaoCifrasBotoes").style.display="";var s=document.getElementById("tdVolume");s.setAttribute("rowspan",""),s.setAttribute("colspan",5),document.getElementById("volumeDiv").style.display="block",document.getElementById("textoVolume").classList.remove("textoVertical"),document.getElementById("volumeInput").setAttribute("orient",""),$("#tdVolume").appendTo("#orgaoTable"),$("#orgaoTable").prependTo("#bateriaBox")}addEventCifras(a)}function addEventCifras(e){for(var o=e.contentDocument.getElementsByTagName("b"),a=0;a<o.length;a++)o[a].addEventListener("click",function(e){var o=document.getElementById("textoCifras").contentDocument.getElementsByClassName("cifraSelecionada");o.length>0&&o[0].classList.remove("cifraSelecionada"),e.target.classList.add("cifraSelecionada"),e.target.scrollIntoView(),parent.tocarCifraManualmente(e.target)})}function tocarCifraManualmente(e){_cifraId=e.id.split("cifra")[1]-1,!1==_cifraParado&&avancarCifra("avancar",document.getElementById("cifraAvancar"))}deixarAcompanhamentoSelecionado("full"),document.getElementById("selectRitmo").addEventListener("change",function(e){if((_grupoNotas=verificarGrupoNotasInstanciado(_grupoNotas)).effects.length>0){var o=document.getElementById("bpmRange").value;o=30/o,_grupoNotas.effects[0].time=o}}),document.getElementById("bpm").addEventListener("change",function(e){if((_grupoNotas=verificarGrupoNotasInstanciado(_grupoNotas)).effects.length>0){var o=document.getElementById("bpmRange").value;o=30/o,_grupoNotas.effects[0].time=o}}),document.getElementById("autoCheck").addEventListener("change",function(e){_autoMudarRitmo=this.checked}),document.getElementById("instrumentoSelect").addEventListener("change",e=>{var o;_instrumentoSelecionado=document.getElementById("instrumentoSelect").value.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}),window.addEventListener("orientationchange",e=>{var o;0==e.target.screen.orientation.angle?mudarTamanhoFrameCifras(!0):mudarTamanhoFrameCifras(!1)});var _cifraId=0,_cifraParado=!0;function avancarCifra(e,o){if(""==e)escolherAcorde("",o),document.getElementById("gravar").style.display="block",document.getElementById("play-pause").style.display="none";else if("repetir"==e)!1==_cifraParado&&verificarAcompanhamentoEtocar(_acordeAntesSelecionado,50);else{var a=document.getElementById("textoCifras"),t=a.contentDocument,n=t.getElementsByTagName("b"),a=document.getElementById("textoCifras"),r=t.getElementsByClassName("cifraSelecionada");if("avancar"==e&&_cifraId<n.length){r.length>0&&r[0].classList.remove("cifraSelecionada"),_cifraParado=!1;var s=n[_cifraId],i=document.getElementById("cifraRetroceder");tocarAcorde(s.innerHTML.trim(),null),i.classList.contains("pressionado")&&i.classList.remove("pressionado"),o.classList.toggle("pressionado",!0),s.classList.add("cifraSelecionada"),s.scrollIntoView(),_cifraId++}if("retroceder"==e&&_cifraId-1>0){r.length>0&&r[0].classList.remove("cifraSelecionada"),!1==_cifraParado&&_cifraId--;var s=n[_cifraId-1],l=document.getElementById("cifraAvancar");tocarAcorde(s.innerHTML.trim(),null),l.classList.contains("pressionado")&&l.classList.remove("pressionado"),o.classList.toggle("pressionado",!0),s.classList.add("cifraSelecionada"),s.scrollIntoView()}document.getElementById("gravar").style.display="none",document.getElementById("play-pause").style.display="block"}}function mudarTamanhoFrameCifras(e){"none"!=document.getElementById("textoCifrasFrame").style.display&&(e?document.getElementById("textoCifras").style.height="250px":document.getElementById("textoCifras").style.height="150px")}function selecionarStrings(e){e?(_stringsSelecionado=!0,_stringsParado&&""!=_acordeAntesSelecionado&&(_stringsParado=!1,(_grupoNotasStrings=montarAcorde(_acordeAntesSelecionado,_grupoNotasStrings=verificarGrupoNotasInstanciado(_grupoNotas),"strings")).play())):_stringsSelecionado=!1,autoMudarRitmo()}