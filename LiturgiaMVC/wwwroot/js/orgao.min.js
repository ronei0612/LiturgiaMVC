var _grupoNotas,_grupoNotasStrings,_acordeSelecionado="",_acordeAntesSelecionado="",_acompanhamentoSelecionado="",_acompanhamentoSolo=!1,_acompanhamentoFull=!1,_acompanhamentoMao=!1,_volume=.9,_instrumentoSelecionado="orgao",_stringsSelecionado=!1,_stringsParado=!0,_autoMudarRitmo=!1,_cifraId=0,_cifraParado=!0;const notasAcordes=Object.keys(notasAcordesJson);var tremolo=new Pizzicato.Effects.Tremolo({speed:1,depth:.6,mix:.8}),flanger=new Pizzicato.Effects.Flanger({time:.45,speed:.2,depth:.1,feedback:.1,mix:.2}),pingPongDelay=new Pizzicato.Effects.PingPongDelay({feedback:.6,time:.4,mix:.5}),delay=new Pizzicato.Effects.Delay({feedback:.5,time:.33,mix:.1});function deixarAcompanhamentoSelecionado(e){escolherAcompanhamento(e,document.getElementById(e))}function ocultarBotaoRec(e=!0){e?(document.getElementById("gravar").style.display="none",document.getElementById("play-pause").style.display="block"):(document.getElementById("gravar").style.display="block",document.getElementById("play-pause").style.display="none")}function escolherAcorde(e,o){_cifraId>0&&(_cifraParado=!0,_cifraId--),_acordeSelecionado=_acordeAntesSelecionado==e?"":e,o&&levantarBotoesAcordes(),""==_acordeSelecionado?(_acordeAntesSelecionado=_acordeSelecionado,pararOsAcordes(),o&&ocultarBotaoRec(!1)):(tocarAcorde(e,o),o&&ocultarBotaoRec())}function autoMudarRitmo(e=null){if("none"!==document.getElementById("pararBateriaBotao").style.display&&_autoMudarRitmo){var o=new Event("click"),a=e||document.querySelector(".selecionado");_stringsSelecionado?("solo"===a.id||"mao"===a.id)&&"epiano"===_instrumentoSelecionado?document.getElementById("chimbal").dispatchEvent(o):("solo"===a.id||"mao"===a.id)&&"orgao"===_instrumentoSelecionado?document.getElementById("brush").dispatchEvent(o):"full"===a.id&&"epiano"===_instrumentoSelecionado?document.getElementById("meiaLua").dispatchEvent(o):"full"===a.id&&"orgao"===_instrumentoSelecionado&&document.getElementById("aro").dispatchEvent(o):("solo"===a.id||"mao"===a.id)&&"epiano"===_instrumentoSelecionado?document.getElementById("aro").dispatchEvent(o):("solo"===a.id||"mao"===a.id)&&"orgao"===_instrumentoSelecionado?document.getElementById("brush").dispatchEvent(o):"full"===a.id&&"epiano"===_instrumentoSelecionado?document.getElementById("caixa").dispatchEvent(o):"full"===a.id&&"orgao"===_instrumentoSelecionado&&document.getElementById("aro").dispatchEvent(o)}}function escolherAcompanhamento(e,o){_acompanhamentoSelecionado=e,pressionarBotaoAcompanhamento(o),autoMudarRitmo(o)}function tocarAcorde(e,o){o?(""!=o.value?verificarAcompanhamentoEtocar(o.value):verificarAcompanhamentoEtocar(e),o.classList.toggle("pressionado",!0)):verificarAcompanhamentoEtocar(e)}function setTom(e="C"){document.getElementById("tomSelect").value=e}function montarAcorde(e,o,a="orgao"){if("stringsSolo"===a&&_stringsSelecionado&&(a="strings"),e.includes("_")&&(e=e.split("_")[1]),e.length>1&&"b"===e[1]){var t=e[0]+e[1];e=e.replace(t,acidentesCorrespondentesJson[e[0]+e[1]])}if(null!==o){var n=notasAcordesJson[e];if("stringsSolo"===a)o.addSound(acordes["strings_"+n[0]+"_baixo"]),o.addSound(acordes["strings_"+n[0]+"_grave"]);else for(var r=0,s=n.length;r<s;r++)("full"===_acompanhamentoSelecionado||"baixo"===_acompanhamentoSelecionado)&&0===r&&o.addSound(acordes[a+"_"+n[r]+"_grave"]),("full"===_acompanhamentoSelecionado||"baixo"===_acompanhamentoSelecionado)&&"strings"!==a&&o.addSound(acordes[a+"_"+n[r]+"_baixo"]),("full"===_acompanhamentoSelecionado||"mao"===_acompanhamentoSelecionado)&&("stringsSolo"===a?o.addSound(acordes["strings_"+n[0]]):o.addSound(acordes[a+"_"+n[r]]))}return o}function verificarGrupoNotasInstanciado(e,o=null){return null==e&&((e=new Pizzicato.Group).volume=_volume),o?0==e.effects.length&&e.addEffect(o):e.effects.length>0&&e.removeEffect(e.effects[0]),e}function verificarAcompanhamentoEtocar(e,o=0){_acordeAntesSelecionado==e?(pararOsAcordes(!0,!0),o=50):pararOsAcordes(!0),setTimeout(function(){_acordeAntesSelecionado=e,"strings"==_instrumentoSelecionado?(_grupoNotasStrings=montarAcorde(e,_grupoNotasStrings=verificarGrupoNotasInstanciado(_grupoNotasStrings),"stringsSolo")).play():((_grupoNotas=montarAcorde(e,_grupoNotas="epiano"==_instrumentoSelecionado?verificarGrupoNotasInstanciado(_grupoNotas,delay):verificarGrupoNotasInstanciado(_grupoNotas),_instrumentoSelecionado)).play(),_stringsSelecionado&&(_stringsParado||_grupoNotas.sounds.length<10)&&(_stringsParado=!1,(_grupoNotasStrings=montarAcorde(e,_grupoNotasStrings=verificarGrupoNotasInstanciado(_grupoNotasStrings),"strings")).play()))},o)}function pararOsAcordes(e=!1,o=!1){if(null!=_grupoNotas&&(_grupoNotas.stop(),e)){var a=_grupoNotas.sounds.length;for(let t=a-1;t>-1;t--)_grupoNotas.removeSound(_grupoNotas.sounds[t])}if(!1==o&&null!=_grupoNotasStrings&&(_stringsParado=!0,_grupoNotasStrings.stop(),e)){var a=_grupoNotasStrings.sounds.length;for(let n=a-1;n>-1;n--)_grupoNotasStrings.removeSound(_grupoNotasStrings.sounds[n])}}function levantarBotoesAcordes(){var e=document.getElementsByClassName("pressionado");e.length>0&&e[0].classList.toggle("pressionado",!1)}function levantarBotoesAcompanhamento(){var e=document.getElementsByClassName("selecionado");for(let o=0;o<e.length;o++)e[o].classList.toggle("selecionado",!1)}function pressionarBotaoAcompanhamento(e){!1==botaoAcompPressionado(e)&&(""!=_acordeAntesSelecionado&&"epiano"!=_instrumentoSelecionado&&verificarAcompanhamentoEtocar(_acordeAntesSelecionado),levantarBotoesAcompanhamento(),pressionarBotaoAcomp(e))}function botaoAcompPressionado(e){return!!e.classList.contains("selecionado")}function pressionarBotaoAcomp(e){e.classList.toggle("selecionado",!0)}function alterarVolume(e,o){_volume=parseFloat(e),null!=_grupoNotas&&(_grupoNotas.volume=_volume),null!=_grupoNotasStrings&&(_grupoNotasStrings.volume=_volume),e==o?document.getElementById("volumeTexto").innerHTML=10*e:document.getElementById("volumeTexto").innerHTML=10*e+"*"}function mudarTomCifra(e,o){var a=document.getElementById("textoCifras").contentDocument.body.innerHTML;$.ajax({type:"post",url:"Orgao/AlterarTom",data:{texto:a,aumentar:e,quant:o},success:function(e){if(e.success){var o=document.getElementById("textoCifras");o.contentDocument.body.innerHTML=e.message,addEventCifras(o)}else alert(e.message)}})}function mudarTom(e){var o=acordesCampoHarmonicoJson[e];Array.from(document.getElementsByClassName("acorde")).forEach(e=>{var a=e.id.split("_")[1];e.value=o[a]});var a=document.querySelector(".pressionado");a&&escolherAcorde("orgao_"+a.value,a),mudarTomMenor(document.getElementById("tomSelect").selectedIndex)}function mudarTomMenor(e){document.getElementById("textoAcordeMenor").innerText=acordesTons[e+12]}function aumentarTom(e,o,a){var t,n=document.getElementById(a),r=n.selectedIndex,s=n.value.includes("m")?tonsMenores:tonsMaiores;t=e?(r+o)%n.length:(r-o+n.length)%n.length,n.value=s[t],"block"===document.getElementById("textoCifrasFrame").style.display?mudarTomCifra(e,o):mudarTom(n.value)}function adicionarTonsSelect(e,o,a){var t=document.getElementById(e);t.innerHTML="",(a?tonsMaiores:tonsMenores).forEach(e=>{let o=new Option(e,e);t.add(o)}),t.selectedIndex=o}function mostrarTextoArquivoCarregado(e=null,o=null){e&&adicionarTonsSelect("tomSelect",e.includes("m")?tonsMenores.indexOf(e):tonsMaiores.indexOf(e),!e.includes("m"));var a=document.getElementById("textoCifras"),t=document.getElementById("textoCifrasFrame");if(o&&(a.contentDocument.body.innerHTML=o),a.contentWindow.document.querySelector("pre").style.color=document.body.classList.contains("bg-dark")?"#fff":"#000","none"===t.style.display){t.style.display="block",Array.from(document.getElementsByClassName("orgaoBotoes")).forEach(e=>{e.style.display="none"}),document.getElementById("container").classList.remove("d-sm-flex");var n=document.getElementById("volumeDiv");n.style.display="none",document.getElementById("voltar").style.display="block",document.getElementById("botaoFonte").style.display="block",document.getElementById("selectFonte").style.display="none",document.getElementById("tomMenorSwitchDiv").style.display="none",document.getElementById("orgaoCifrasBotoes").style.display="";var r=document.getElementById("tdVolume");r.setAttribute("rowspan",""),r.setAttribute("colspan",5),n.style.display="block",document.getElementById("textoVolume").classList.remove("textoVertical"),document.getElementById("volumeInput").setAttribute("orient",""),$("#tdVolume").appendTo("#orgaoTable"),$("#orgaoTable").prependTo("#bateriaBox")}addEventCifras(a)}function addEventCifras(e){for(var o=e.contentDocument.getElementsByTagName("b"),a=0;a<o.length;a++)o[a].addEventListener("click",function(e){var o=document.getElementById("textoCifras").contentDocument.getElementsByClassName("cifraSelecionada");o.length>0&&o[0].classList.remove("cifraSelecionada"),e.target.classList.add("cifraSelecionada"),e.target.scrollIntoView(),parent.tocarCifraManualmente(e.target)})}function tocarCifraManualmente(e){_cifraId=e.id.split("cifra")[1]-1,!1==_cifraParado&&avancarCifra("avancar",document.getElementById("cifraAvancar"))}function avancarCifra(e,o){var a=document.getElementById("gravar"),t=document.getElementById("play-pause"),n=document.getElementById("cifraRetroceder"),r=document.getElementById("cifraAvancar");if(""===e)escolherAcorde("",o),a.style.display="block",t.style.display="none";else if("repetir"!==e||_cifraParado){var s=document.getElementById("textoCifras").contentDocument,i=s.getElementsByTagName("b"),l=s.getElementsByClassName("cifraSelecionada");"avancar"===e&&_cifraId<i.length&&processarCifraAvancarRetroceder(l,n,o,i),"retroceder"===e&&_cifraId-1>0&&processarCifraAvancarRetroceder(l,r,o,i,!0),a.style.display="none",t.style.display="block"}else verificarAcompanhamentoEtocar(_acordeAntesSelecionado,50)}function processarCifraAvancarRetroceder(e,o,a,t,n=!1){e.length>0&&e[0].classList.remove("cifraSelecionada"),_cifraParado=!!n&&_cifraParado;var r=t[n?_cifraId-1:_cifraId],s=n?document.getElementById("cifraAvancar"):document.getElementById("cifraRetroceder");tocarAcorde(r.innerHTML.trim(),null),s.classList.contains("pressionado")&&s.classList.remove("pressionado"),a.classList.toggle("pressionado",!0),r.classList.add("cifraSelecionada"),r.scrollIntoView(),_cifraId+=n?-1:1}function mudarTamanhoFrameCifras(e){"none"!=document.getElementById("textoCifrasFrame").style.display&&(e?document.getElementById("textoCifras").style.height="250px":document.getElementById("textoCifras").style.height="150px")}function selecionarStrings(e){e?(_stringsSelecionado=!0,_stringsParado&&""!=_acordeAntesSelecionado&&(_stringsParado=!1,(_grupoNotasStrings=montarAcorde(_acordeAntesSelecionado,_grupoNotasStrings=verificarGrupoNotasInstanciado(_grupoNotas),"strings")).play())):_stringsSelecionado=!1,autoMudarRitmo()}deixarAcompanhamentoSelecionado("full"),document.getElementById("selectRitmo").addEventListener("change",function(e){if((_grupoNotas=verificarGrupoNotasInstanciado(_grupoNotas)).effects.length>0){var o=document.getElementById("bpmRange").value;o=30/o,_grupoNotas.effects[0].time=o}}),document.getElementById("bpm").addEventListener("change",function(e){if((_grupoNotas=verificarGrupoNotasInstanciado(_grupoNotas)).effects.length>0){var o=document.getElementById("bpmRange").value;o=30/o,_grupoNotas.effects[0].time=o}}),document.getElementById("autoCheck").addEventListener("change",function(e){_autoMudarRitmo=this.checked}),document.getElementById("instrumentoSelect").addEventListener("change",e=>{var o;_instrumentoSelecionado=document.getElementById("instrumentoSelect").value.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}),window.addEventListener("orientationchange",e=>{var o;0==e.target.screen.orientation.angle?mudarTamanhoFrameCifras(!0):mudarTamanhoFrameCifras(!1)});