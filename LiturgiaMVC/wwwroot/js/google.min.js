var accessToken;const clientId="982717214287-u57uddj8lrd7dq0n5i4fquuvci8umd60.apps.googleusercontent.com",redirectUri="https://localhost:7188/orgao",scope="https://www.googleapis.com/auth/drive";function authorizeGoogle(){let o=`https://accounts.google.com/o/oauth2/auth?client_id=982717214287-u57uddj8lrd7dq0n5i4fquuvci8umd60.apps.googleusercontent.com&redirect_uri=https://localhost:7188/orgao&response_type=token&scope=${encodeURIComponent("https://www.googleapis.com/auth/drive")}`;window.location.href=o}async function processToken(){let o=new URLSearchParams(window.location.hash.substr(1)),e=o.get("access_token");e?(localStorage.setItem("accessToken",e),localStorage.setItem("accessTokenExpiry",Date.now()+36e5)):console.error("Erro ao obter o token de acesso ou ID da pasta.")}async function criarArquivoNoGoogleDrive(o){try{let e=await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=media",{method:"POST",headers:{Authorization:`Bearer ${accessToken}`,"Content-Type":"text/plain"},body:o}),t=await e.json(),a=t.id;localStorage.setItem("fileId",a),mostrarModal("compartilhado")}catch(r){console.error("Erro ao criar o arquivo:",r)}}function criarArquivodoStorage(){let o=verificarSeJaCompartilhado();if(""!==o){if(localStorage.setItem("criandoArquivo","true"),validarToken()){localStorage.removeItem("criandoArquivo");let e=criptografarTexto(o);localStorage.setItem("compartilhadoMD5",e),criarArquivoNoGoogleDrive(o)}}else mostrarModal("compartilhado")}async function validarToken(){accessToken=localStorage.getItem("accessToken");let o=localStorage.getItem("accessTokenExpiry");if(!accessToken)return authorizeGoogle(),!1;o&&!(Date.now()<parseInt(o))&&localStorage.removeItem("accessToken");try{let e=await fetch(`https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=${accessToken}`);if(!e.ok)throw Error("Erro ao validar o token:",e.status);await e.json()}catch(t){console.error(t),localStorage.removeItem("accessToken"),authorizeGoogle()}return!0}function carregarSalvosLocalStorage(){let o=localStorage.getItem("salvamentos"),e=o.split(",");e.shift();var t="";if(e&&e.length>0){let a={};e.forEach(o=>{let e=localStorage.getItem(o);a[o]=e});let r=JSON.stringify(a);t=r}return t}function criptografarTexto(o){return CryptoJS.MD5(o).toString()}function verificarSeJaCompartilhado(){let o=localStorage.getItem("fileId"),e=localStorage.getItem("salvamentos"),t=criptografarTexto(e),a=localStorage.getItem("compartilhadoMD5");return a&&o&&t===a?"":e}function copiarTextoParaClipboard(o){var e=document.createElement("textarea");e.value=o,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),alert("Texto copiado!"),ocultarModal()}function compartilharMobile(o){navigator.share?navigator.share({title:"Compartilhar",text:o}).then(()=>console.log("Conte\xfado compartilhado com sucesso!")).catch(o=>console.error("Erro ao compartilhar:",o)):window.location.href="https://api.whatsapp.com/send?text="+o}window.onload=function(){window.location.hash&&(processToken(),window.location.href.includes("#access_token")&&(document.location.hash="",criarArquivodoStorage()))};